<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitness Tracker mit Dark Mode</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: sans-serif;
    max-width: 700px;
    margin: auto;
    padding: 20px;
    background: #f9f9f9;
    color: #222;
    transition: background-color 0.3s, color 0.3s;
  }
  input, button, select {
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: white;
    color: #222;
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
  }
  button {
    cursor: pointer;
    background-color: #4caf50;
    color: white;
    border: none;
  }
  button:hover {
    background-color: #45a049;
  }
  .entry {
    background: #fff;
    padding: 10px;
    margin: 8px 0;
    border-left: 5px solid #4caf50;
    transition: background-color 0.3s, border-color 0.3s;
  }
  canvas {
    background: #fff;
    border-radius: 8px;
    padding: 10px;
    transition: background-color 0.3s;
  }
  #set-adder {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-top: 15px;
    background: #fefefe;
    transition: background-color 0.3s, border-color 0.3s;
  }
  #reps, #weight {
    text-align: center;
  }
  .set-input-container {
    display: flex;
    gap: 10px;
  }
  /* Dark Mode Styles */
  body.dark {
    background-color: #121212;
    color: #e0e0e0;
  }
  body.dark input, 
  body.dark button, 
  body.dark select {
    background-color: #1e1e1e;
    color: #e0e0e0;
    border: 1px solid #444;
  }
  body.dark button {
    background-color: #388e3c;
    color: #e0e0e0;
  }
  body.dark button:hover {
    background-color: #2e7d32;
  }
  body.dark .entry {
    background-color: #1c1c1c;
    border-left-color: #81c784;
  }
  body.dark canvas {
    background-color: #1c1c1c;
  }
  body.dark #set-adder {
    background-color: #1c1c1c;
    border-color: #444;
  }
  /* Dark Mode Toggle Switch */
  .toggle-container {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    justify-content: flex-end;
  }
  .toggle-label {
    margin-right: 10px;
    font-weight: bold;
  }
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
  }
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }
  input:checked + .slider {
    background-color: #4caf50;
  }
  input:checked + .slider:before {
    transform: translateX(26px);
  }
</style>
</head>
<body>

<div class="toggle-container">
  <span class="toggle-label">Dark Mode</span>
  <label class="toggle-switch">
    <input type="checkbox" id="darkModeToggle" />
    <span class="slider"></span>
  </label>
</div>

<h1>üìã Fitness Tracker</h1>

<input type="text" id="exercise" placeholder="√úbung (z.‚ÄØB. Bankdr√ºcken)" list="exercise-list" />
<datalist id="exercise-list"></datalist>
<input type="date" id="date" />

<!-- Bereich zum Hinzuf√ºgen von S√§tzen -->
<div id="set-adder">
  <h4>Satz hinzuf√ºgen f√ºr <span id="current-exercise-display" style="color: #4caf50;"></span></h4>
  <div class="set-input-container">
    <input type="number" id="reps" placeholder="Wiederholungen" min="1" />
    <input type="number" id="weight" placeholder="Gewicht (kg)" min="0" step="0.1" />
  </div>
  <button onclick="addSet()">‚ûï Satz hinzuf√ºgen</button>
  
  <h5>Aktuelle S√§tze f√ºr heute:</h5>
  <ul id="set-list"></ul>
</div>

<button onclick="saveExercise()" style="margin-top: 15px;">‚úÖ √úbung mit S√§tzen speichern</button>

<h2>üìà Fortschritt anzeigen</h2>
<select id="exerciseSelect" onchange="updateChart()">
  <option value="">-- √úbung w√§hlen --</option>
</select>

<canvas id="progressChart" width="600" height="300"></canvas>

<h2>üóíÔ∏è Trainingsverlauf</h2>
<div id="trainingLog"></div>

<script>
  // Initialisierung
  let trainingsDaten = JSON.parse(localStorage.getItem('trainingsDaten')) || {};
  let √ºbungen = JSON.parse(localStorage.getItem('√ºbungen')) || [];
  let currentSets = [];

  // UI-Elemente
  const exerciseInput = document.getElementById('exercise');
  const dateInput = document.getElementById('date');
  const repsInput = document.getElementById('reps');
  const weightInput = document.getElementById('weight');
  const setList = document.getElementById('set-list');
  const currentExerciseDisplay = document.getElementById('current-exercise-display');
  const darkModeToggle = document.getElementById('darkModeToggle');

  // Dark Mode Logik
  if(localStorage.getItem('darkMode') === 'enabled') {
    document.body.classList.add('dark');
    darkModeToggle.checked = true;
  }
  darkModeToggle.addEventListener('change', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark') ? 'enabled' : 'disabled');
  });

  // Event Listener f√ºr √úbungs-Input
  exerciseInput.addEventListener('input', () => {
    currentExerciseDisplay.textContent = exerciseInput.value || '...';
  });

  // Hilfsfunktionen f√ºr √úbungsliste
  function addExerciseToList(exercise) {
    if (!√ºbungen.includes(exercise)) {
      √ºbungen.push(exercise);
      √ºbungen.sort();
      localStorage.setItem('√ºbungen', JSON.stringify(√ºbungen));
      updateExerciseDropdowns();
    }
  }

  function updateExerciseDropdowns() {
    const exerciseSelect = document.getElementById('exerciseSelect');
    const exerciseList = document.getElementById('exercise-list');
    const selectedValue = exerciseSelect.value;

    exerciseSelect.innerHTML = '<option value="">-- √úbung w√§hlen --</option>';
    √ºbungen.forEach(ex => {
      const option = document.createElement('option');
      option.value = ex;
      option.textContent = ex;
      exerciseSelect.appendChild(option);
    });
    exerciseSelect.value = selectedValue;

    exerciseList.innerHTML = '';
    √ºbungen.forEach(ex => {
      const option = document.createElement('option');
      option.value = ex;
      exerciseList.appendChild(option);
    });
  }

  // Satz-Logik
  function addSet() {
    const reps = parseInt(repsInput.value);
    const weight = parseFloat(weightInput.value);

    if (isNaN(reps) || isNaN(weight)) {
      alert('Bitte Wiederholungen und Gewicht f√ºr den Satz eingeben.');
      return;
    }
    currentSets.push({ reps, weight });
    renderCurrentSets();
    repsInput.value = '';
    weightInput.value = '';
    repsInput.focus();
  }

  function renderCurrentSets() {
    setList.innerHTML = '';
    currentSets.forEach((s, index) => {
      const li = document.createElement('li');
      li.textContent = `Satz ${index + 1}: ${s.reps} Wiederholungen mit ${s.weight} kg`;
      setList.appendChild(li);
    });
  }

  // Speicher-Logik
  function saveExercise() {
    const exercise = exerciseInput.value.trim();
    const date = dateInput.value;

    if (!exercise || !date) {
      alert('Bitte √úbung und Datum ausw√§hlen.');
      return;
    }
    if (currentSets.length === 0) {
      alert('Bitte f√ºgen Sie mindestens einen Satz hinzu.');
      return;
    }

    addExerciseToList(exercise);

    if (!trainingsDaten[date]) {
      trainingsDaten[date] = [];
    }
    
    // Ersetze existierende √úbung am selben Tag oder f√ºge sie neu hinzu
    const existingEntryIndex = trainingsDaten[date].findIndex(e => e.exercise === exercise);
    if (existingEntryIndex > -1) {
      trainingsDaten[date][existingEntryIndex].sets.push(...currentSets);
    } else {
      trainingsDaten[date].push({ exercise, sets: currentSets });
    }

    localStorage.setItem('trainingsDaten', JSON.stringify(trainingsDaten));

    // Reset
    currentSets = [];
    renderCurrentSets();
    exerciseInput.value = '';
    currentExerciseDisplay.textContent = '...';
    
    renderTrainingLog();
    updateChart();
  }

  // Anzeige-Logik
  function renderTrainingLog() {
    const log = document.getElementById('trainingLog');
    log.innerHTML = '';
    const dates = Object.keys(trainingsDaten).sort().reverse(); // Neueste zuerst

    dates.forEach(date => {
      const entries = trainingsDaten[date];
      const dateDiv = document.createElement('div');
      dateDiv.innerHTML = `<h3>${date}</h3>`;

      entries.forEach(e => {
        const entryDiv = document.createElement('div');
        entryDiv.className = 'entry';
        let content = `<strong>${e.exercise}</strong><ul>`;
        e.sets.forEach((s, i) => {
          content += `<li>Satz ${i + 1}: ${s.reps} x ${s.weight} kg</li>`;
        });
        content += '</ul>';
        entryDiv.innerHTML = content;
        dateDiv.appendChild(entryDiv);
      });
      log.appendChild(dateDiv);
    });
  }

  // Chart-Logik
  let chart;
  function updateChart() {
    const selectedExercise = document.getElementById('exerciseSelect').value;
    if (!selectedExercise) {
      if (chart) chart.destroy();
      return;
    }

    const dates = Object.keys(trainingsDaten).sort();
    const labels = [];
    const maxWeights = [];

    dates.forEach(date => {
      const matchingEntry = trainingsDaten[date].find(e => e.exercise === selectedExercise);
      if (matchingEntry) {
        const maxWeightForDay = Math.max(...matchingEntry.sets.map(s => s.weight));
        if (maxWeightForDay > 0) {
          labels.push(date);
          maxWeights.push(maxWeightForDay);
        }
      }
    });

    const firstWeight = maxWeights[0] || 0;
    const percentChange = maxWeights.map(w => firstWeight === 0 ? 0 : ((w - firstWeight) / firstWeight * 100).toFixed(1));

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('progressChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'Max Gewicht (kg)',
            data: maxWeights,
            borderColor: '#4caf50',
            yAxisID: 'y',
          },
          {
            label: 'Ver√§nderung (%)',
            data: percentChange,
            borderColor: '#2196f3',
            yAxisID: 'y1',
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { type: 'linear', position: 'left', title: { display: true, text: 'Gewicht (kg)' }},
          y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Ver√§nderung (%)' }}
        }
      }
    });
  }

  // Initiale Darstellung
  updateExerciseDropdowns();
  renderTrainingLog();
  updateChart();
  dateInput.valueAsDate = new Date();
  currentExerciseDisplay.textContent = '...';
</script>

</body>
</html>
